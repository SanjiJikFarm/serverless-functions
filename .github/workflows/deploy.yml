name: Deploy to Naver Cloud Functions

on:
  push:
    branches:
      - main
    paths:
      - "src/**"
      - "serverless.yml"
      - "package.json"
      - "package-lock.json"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install dependencies
        run: npm install

      - name: Install Serverless Framework v3 (no login required)
        run: npm install -g serverless@3

      - name: Set environment variables
        run: |
          echo "NCLOUD_ACCESS_KEY=${{ secrets.NCLOUD_ACCESS_KEY }}" >> $GITHUB_ENV
          echo "NCLOUD_SECRET_KEY=${{ secrets.NCLOUD_SECRET_KEY }}" >> $GITHUB_ENV

      - name: Deploy with Serverless Framework
        run: serverless deploy
